---
title: ruby中\1和$1的区别
date: 2018-03-28 23:19:30
tags: regex
categories: Ruby
---

在此之前要介绍下正则表达式中的组(group)和回溯引用(backreference)的含义

##组和回溯引用

在正则表达式中，每个括号括起来的部分叫做一个组，比如表达式

```
(\d{2})([a-z])
```

组1为\d{2}
组2为[a-z]
其中，还暗含了一个组0，即整个正则表达式。以11abcd为例，如果我们采用上面的正则表达式，则组1为11，组2为abcd有了组的概念后，我们便可以利用这个组来做文章，比如，如果我们要找重复了两次的数字，如11,22，可以写这样的表达式：

```
(\d)\1
```

它的意思是，第一个是数字，第二个数字跟第一个数字相同。正则表达式中，用了一个专门的术语来描述\1这种概念，即**回溯引用**。比如参考链接中的例子
“公司最近打算升级号码管理，针对VIP客户推出靓号服务，暂定靓号为6位，尾数AAAA的为靓号，比如118888是靓号。”
在Ruby中我们就可以使用

```
/[1-9]\d(\d)\1{3}/ 
```

来匹配我们想要的号码

简单来说，$1或者\1包含的是正则表达式中从左侧开始的第一对小括号内的子模式所匹配的字符串

同理$2和\2表示的是第二对小括号匹配的字符串,比如

```
irb(main):171:0> /([a-z]+)([0-9]+)/.match('abc33')
=> #<MatchData "abc33" 1:"abc" 2:"33">
irb(main):172:0> $1
=> "abc"
irb(main):173:0> $2
=> "33"
```

也可以像使用数组一样取出MatchData中符合各个子匹配的内容，比如

```ruby
irb(main):176:0> a=/([a-z]+)([0-9]+)/.match('abc33')
=> #<MatchData "abc33" 1:"abc" 2:"33">
irb(main):177:0> a[0]
=> "abc33"
irb(main):178:0> a[1]
=> "abc"
irb(main):179:0> a[2]
=> "33"
```

其中a[0]返回匹配主表达式的字符串

## \1和$1的不同

不的是两者的作用域

回溯引用\1只作用于方法sub或者gsub中，作用域有限

```
"foobar".sub(/foo(.*)/, '\1\1') # => "barbar"
```

而$1作为全局变量可以作用于接下来的代码

```
if "foobar" =~ /foo(.*)/ then 
  puts "The matching word was #{$1}"
end
```

输出

```
"The matching word was bar"
=> nil
```

参考链接

[$1 and \1 in Ruby](https://stackoverflow.com/questions/288573/1-and-1-in-ruby)

[组（group）和回溯引用(backreference)](https://blog.csdn.net/hbr2014/article/details/47657937)
